<%# app/views/setup/product_categories/index.html.erb %>
<% content_for :title, "Product Categories" %>
<% content_for :breadcrumb do %>
  <span style="color:var(--text-dim)">Setup</span>
  <span class="breadcrumb-sep">/</span>
  <span class="breadcrumb-current">Product Categories</span>
<% end %>

<%= render 'setup/shared/master_styles' %>

<div class="page-header">
  <div>
    <div class="page-title">Master Data</div>
  </div>
  <%= link_to new_setup_product_category_path, class: 'btn btn-primary' do %>
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
      <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
    New Category
  <% end %>
</div>

<%= render 'setup/shared/nav_tabs' %>

<div class="filter-bar">
  <div class="search-input-wrap">
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
    </svg>
    <input type="text" class="search-input" placeholder="Search categories..." id="catSearch">
  </div>
  <select id="catStatusFilter" style="background:var(--surface);border:1px solid var(--border);
          border-radius:6px;padding:8px 12px;color:var(--text);font-size:13px;outline:none">
    <option value="">All Statuses</option>
    <option value="active">Active</option>
    <option value="inactive">Inactive</option>
  </select>
</div>

<div class="table-wrap">
  <% if @categories.any? %>
    <table id="catTable">
      <thead>
        <tr>
          <th>#</th><th>Name</th><th>Description</th>
          <th>Products</th><th>Status</th><th>Created</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @categories.each do |cat| %>
        <tr>
          <td style="font-family:var(--mono);color:var(--text-dim);font-size:12px"><%= cat.id %></td>
          <td><%= link_to cat.name, setup_product_category_path(cat), style: 'font-weight:500' %></td>
          <td style="color:var(--text-dim);font-size:13px;max-width:280px">
            <%= cat.description.present? ? cat.description.truncate(60) : 'â€”' %>
          </td>
          <td style="font-family:var(--mono)">
            <% count = cat.products.count %>
            <% if count > 0 %>
              <span style="color:var(--accent)"><%= count %></span>
            <% else %>
              <span style="color:var(--text-muted)">0</span>
            <% end %>
          </td>
          <td>
            <span class="badge <%= cat.active? ? 'badge-active' : 'badge-inactive' %>"
                  data-status="<%= cat.active? ? 'active' : 'inactive' %>">
              <%= cat.active? ? 'active' : 'inactive' %>
            </span>
          </td>
          <td style="color:var(--text-dim);font-size:12px;font-family:var(--mono)">
            <%= cat.created_at.strftime('%d %b %Y') %>
          </td>
          <td>
            <div class="actions">
              <%= link_to 'View', setup_product_category_path(cat), class: 'btn btn-secondary btn-sm' %>
              <%= link_to 'Edit', edit_setup_product_category_path(cat), class: 'btn btn-secondary btn-sm' %>
              <% if cat.can_delete? %>
                <%= button_to 'Delete', setup_product_category_path(cat),
                      method: :delete,
                      class: 'btn btn-danger btn-sm',
                      form: { style: 'margin:0' },
                      data: { confirm: "Delete \"#{cat.name}\"?" } %>
              <% end %>
            </div>
          </td>
        </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <div class="empty-state">
      <svg width="36" height="36" fill="none" stroke="currentColor" stroke-width="1"
           viewBox="0 0 24 24" style="color:var(--muted);margin:0 auto 12px;display:block">
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
      </svg>
      <p>No product categories yet.</p>
      <div style="margin-top:16px">
        <%= link_to 'Add first category', new_setup_product_category_path, class: 'btn btn-primary' %>
      </div>
    </div>
  <% end %>
</div>

<script>
  function filterCats() {
    const q      = document.getElementById('catSearch').value.toLowerCase();
    const status = document.getElementById('catStatusFilter').value;
    document.querySelectorAll('#catTable tbody tr').forEach(row => {
      const text      = row.textContent.toLowerCase();
      const rowStatus = row.querySelector('[data-status]')?.dataset.status || '';
      row.style.display = (!q || text.includes(q)) && (!status || rowStatus === status) ? '' : 'none';
    });
  }
  document.getElementById('catSearch').addEventListener('input', filterCats);
  document.getElementById('catStatusFilter').addEventListener('change', filterCats);
</script>

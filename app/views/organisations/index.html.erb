<% content_for :title, "Organisations" %>
<% content_for :breadcrumb do %>
  <span class="breadcrumb-current">Organisations</span>
<% end %>

<div class="page-header">
  <div>
    <div class="page-title">Organisations</div>
    <div class="page-subtitle">Manage all tenants on this platform</div>
  </div>
  <%= link_to new_organisation_path, class: 'btn btn-primary' do %>
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
      <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
    New Organisation
  <% end %>
</div>

<div class="stats-row">
  <div class="stat-card">
    <div class="stat-label">Total Orgs</div>
    <div class="stat-value accent"><%= @organisations.count %></div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Active</div>
    <div class="stat-value success"><%= @organisations.active.count %></div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Inactive</div>
    <div class="stat-value" style="color:var(--danger)"><%= @organisations.inactive.count %></div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Total Users</div>
    <div class="stat-value"><%= @organisations.sum { |o| o.users.count } %></div>
  </div>
</div>

<div class="filter-bar">
  <div class="search-input-wrap">
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
    </svg>
    <input type="text" class="search-input" placeholder="Search organisations..." id="orgSearch">
  </div>
</div>

<div class="table-wrap">
  <% if @organisations.any? %>
    <table id="orgTable">
      <thead>
        <tr>
          <th>#</th><th>Name</th><th>GST Number</th><th>Plan</th>
          <th>Users</th><th>Status</th><th>Created</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @organisations.each do |org| %>
        <tr>
          <td style="font-family:var(--mono);color:var(--text-dim);font-size:12px"><%= org.id %></td>
          <td>
            <%= link_to org.name, organisation_path(org) %>
            <% if org.address.present? %>
              <div style="font-size:12px;color:var(--text-dim);margin-top:2px"><%= org.address.truncate(40) %></div>
            <% end %>
          </td>
          <td style="font-family:var(--mono);font-size:12px"><%= org.gst_number.presence || 'â€”' %></td>
          <td><span class="badge badge-plan"><%= org.subscription_plan.presence || 'basic' %></span></td>
          <td style="font-family:var(--mono)"><%= org.users.count %></td>
          <td>
            <span class="badge <%= org.active? ? 'badge-active' : 'badge-inactive' %>"><%= org.status %></span>
          </td>
          <td style="color:var(--text-dim);font-size:12px;font-family:var(--mono)">
            <%= org.created_at.strftime('%d %b %Y') %>
          </td>
          <td>
            <div class="actions">
              <%= link_to 'View', organisation_path(org), class: 'btn btn-secondary btn-sm' %>
              <%= link_to 'Edit', edit_organisation_path(org), class: 'btn btn-secondary btn-sm' %>
            </div>
          </td>
        </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <div class="empty-state">
      <svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="1" viewBox="0 0 24 24"
           style="color:var(--muted);margin:0 auto 12px;display:block">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
      </svg>
      <p>No organisations yet.</p>
      <div style="margin-top:16px">
        <%= link_to 'Create your first organisation', new_organisation_path, class: 'btn btn-primary' %>
      </div>
    </div>
  <% end %>
</div>

<script>
  document.getElementById('orgSearch').addEventListener('input', function() {
    const q = this.value.toLowerCase();
    document.querySelectorAll('#orgTable tbody tr').forEach(row => {
      row.style.display = row.textContent.toLowerCase().includes(q) ? '' : 'none';
    });
  });
</script>
